<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>色词匹配小游戏</title>
    <style>
        /* --- 全局与基础样式 --- */
        :root {
            --primary-bg: #111111;
            --secondary-bg: #000000;
            --container-border-color: #3f89f3;
            --primary-text: #ffffff;
            --secondary-text: #b7b7b7;
            --button-bg: #595959;
            --button-hover-bg: #777777;
            --start-button-bg: #3f89f3;
            --start-button-hover-bg: #317fee;
            --correct-color: #2bbc21;
            --incorrect-color: #dc3545;
            --font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
        }

        body {
            background-color: var(--primary-bg);
            color: var(--primary-text);
            font-family: var(--font-family);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            padding: 1rem;
            box-sizing: border-box;
        }

        .hidden { display: none !important; }

        /* --- 欢迎界面 --- */
        #welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            width: 100%;
            max-width: 1800px;
            position: relative;
        }
        
        #welcome-screen .main-title {
            font-size: 3.5rem;
            font-weight: bold;
            letter-spacing: 0.06em;
        }
        
        .content-wrapper {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 2rem;
            width: 100%;
        }

        .instructions-box {
            border: 5px solid var(--container-border-color);
            background-color: var(--secondary-bg);
            border-radius: 12px;
            padding: 2rem 3rem;
            flex-basis: 1100px;
            flex-grow: 1;
        }

        .instructions-box p {
            font-size: 1.8rem;
            letter-spacing: 0.06em;
            margin-top: 0;
        }

        .example-container {
            display: flex;
            align-items: center;
            gap: 2rem;
            margin-top: 3rem;
        }

        .example-word-box {
            border: 2px solid var(--secondary-text);
            padding: 1.5rem 2rem;
            border-radius: 15px;
        }

        .example-word {
            font-size: 6rem;
            font-weight: 900;
            color: var(--correct-color);
        }

        .example-rhs {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            font-size: 2rem;
        }
        
        .example-options {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .example-options .option-item {
            border: 2px solid var(--secondary-text);
            border-radius: 14px;
            padding: 1.5rem;
            position: relative;
            font-size: 1.8rem;
        }
        
        .example-options .option-item::after {
            position: absolute;
            font-size: 2rem;
            bottom: -2.5rem;
            left: 50%;
            transform: translateX(-50%);
        }
        .example-options .correct::after {
            content: '✔';
            color: var(--correct-color);
        }
        .example-options .incorrect::after {
            content: '✖';
            color: var(--incorrect-color);
        }

        .start-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            flex-basis: 300px;
        }

        #emoji {
            width: 150px;
            height: 150px;
        }

        #start-button {
            background-color: var(--start-button-bg);
            color: var(--primary-text);
            font-size: 2.5rem;
            font-weight: bold;
            letter-spacing: 0.05em;
            padding: 1rem 3rem;
            border-radius: 20px;
            border: none;
            cursor: pointer;
        }
        #start-button:hover { background-color: var(--start-button-hover-bg); }


        /* --- 游戏主界面 --- */
        #game-screen {
            display: none;
            width: 98%;
            height: 98%;
            max-width: 1800px;
            max-height: 1000px;
            flex-direction: column;
        }
        
        .top-bar {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            padding: 1rem 0;
        }

        .top-bar .timer-icon {
            width: 70px;
            height: 70px;
        }
        
        .progress-bar-container {
            flex-grow: 1;
            height: 20px;
            background-color: #3d3d3d;
            border-radius: 10px;
        }

        #progress-bar {
            width: 100%;
            height: 100%;
            background-color: var(--container-border-color);
            border-radius: 10px;
            transition: width 1s linear;
        }

        #timer-display {
            font-size: 3rem;
            font-weight: bold;
            width: 150px;
            text-align: right;
        }

        .game-body {
            display: flex;
            flex-grow: 1;
            gap: 2rem;
            margin-top: 1rem;
        }
        
        .main-content {
            flex-grow: 1;
            border: 5px solid var(--container-border-color);
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: row;
            padding: 2rem;
            background-color: var(--secondary-bg);
            position: relative;
            overflow: hidden;
            gap: 4rem;
        }

        #stimulus-container, #feedback-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 4rem;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0; left: 0;
        }
        
        #stimulus-container > div {
             flex: 1;
             display: flex;
             justify-content: center;
             align-items: center;
        }

        #fixation-cross {
            font-size: 8rem;
            color: var(--secondary-text);
            position: absolute;
        }

        #word-box-wrapper {
             border: 3px solid #404040;
             padding: 2rem 3rem;
             border-radius: 18px;
        }

        #stroop-word {
            font-size: 8rem;
            font-weight: 900;
        }

        #options-area {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            align-items: center;
            flex: 1;
        }

        #options-area p {
            font-size: 2.2rem;
            margin: 0;
        }

        #options-container {
            display: flex;
            gap: 1rem;
        }

        .option-btn {
            background: rgba(63, 137, 243, 0.1);
            border: 2px solid rgba(48, 127, 238, 0.25);
            color: var(--container-border-color);
            border-radius: 14px;
            width: 90px;
            height: 90px;
            font-size: 2.2rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .option-btn:hover {
            border-color: var(--container-border-color);
            transform: translateY(-3px);
        }

        #feedback-icon { width: 120px; height: 120px; }
        #feedback-text { font-size: 2rem; }

        .sidebar {
            width: 280px;
            display: flex;
            flex-direction: column;
            gap: 2rem;
            font-size: 1.8rem;
            color: #808080;
            padding-top: 1rem;
        }

        .sidebar p { margin: 0; }
        
        #end-button {
            margin-top: auto;
            background-color: var(--button-bg);
            color: var(--primary-text);
            font-size: 2.2rem;
            font-weight: bold;
            letter-spacing: 0.05em;
            padding: 1rem 0;
            border-radius: 20px;
            border: none;
            cursor: pointer;
        }
        #end-button:hover { background-color: var(--incorrect-color); }

        /* --- 结束游戏弹窗 --- */
        #end-game-modal {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: #1e1e1e;
            padding: 2rem 3rem;
            border-radius: 12px;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            border: 2px solid var(--container-border-color);
        }
        .modal-content p:first-child { font-size: 1.5rem; margin: 0; }
        #modal-countdown { font-size: 1rem; color: var(--secondary-text); }
        #confirm-end-button { background-color: var(--incorrect-color); color: var(--primary-text); border:none; border-radius: 8px; padding: 10px 20px; font-size: 1.2em; cursor: pointer; }

    </style>
</head>
<body>

    <!-- 欢迎界面 -->
    <div id="welcome-screen">
        <h1 class="main-title">色词匹配小游戏</h1>
        <div class="content-wrapper">
            <div class="instructions-box">
                <p>在测试中，你会看到不同颜色的文字。你的目标是选出文字的颜色，而不是文字本身。</p>
                <div class="example-container">
                    <div class="example-word-box"><span class="example-word">红</span></div>
                    <div class="example-rhs">
                        <span>这个字的颜色是</span>
                        <div class="example-options">
                            <div class="option-item incorrect">红</div>
                            <div class="option-item incorrect">黄</div>
                            <div class="option-item correct">绿</div>
                            <div class="option-item incorrect">蓝</div>
                            <div class="option-item incorrect">白</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="start-area">
                <img id="emoji" src="asset/emoji.gif" alt="开心表情">
                <button id="start-button">开始游戏</button>
            </div>
        </div>
    </div>

    <!-- 游戏主界面 -->
    <div id="game-screen">
        <div class="top-bar">
            <img class="timer-icon" src="asset/timer-icon.svg" alt="计时器图标">
            <div class="progress-bar-container"><div id="progress-bar"></div></div>
            <span id="timer-display">02:00</span>
        </div>
        <div class="game-body">
            <div class="main-content">
                <!-- 刺激与反馈容器 -->
                <div id="stimulus-container" class="hidden">
                    <div id="fixation-cross" class="hidden">+</div>
                    <div id="word-presentation" class="hidden">
                         <div id="word-box-wrapper"><span id="stroop-word"></span></div>
                         <div id="options-area">
                            <p>这个字的颜色是</p>
                            <div id="options-container">
                                <button class="option-btn" data-color="red">红</button>
                                <button class="option-btn" data-color="yellow">黄</button>
                                <button class="option-btn" data-color="green">绿</button>
                                <button class="option-btn" data-color="blue">蓝</button>
                                <button class="option-btn" data-color="white">白</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="feedback-container" class="hidden">
                    <svg id="feedback-icon" viewBox="0 0 100 100"></svg>
                    <p id="feedback-text"></p>
                </div>
            </div>
            <div class="sidebar">
                <p>次数: <span id="trials">0</span></p>
                <p>准确率: <span id="accuracy">--</span></p>
                <p>平均反应时间: <span id="avg-reaction-time">--</span></p>
                <button id="end-button">结束游戏</button>
            </div>
        </div>
    </div>

    <!-- 结束游戏确认弹窗 -->
    <div id="end-game-modal">
        <div class="modal-content">
            <p>游戏结束！</p>
            <p id="modal-countdown">5秒后将自动返回主页...</p>
            <button id="confirm-end-button">立即返回</button>
        </div>
    </div>


    <script>
        // --- DOM 元素获取 ---
        const welcomeScreen = document.getElementById('welcome-screen');
        const gameScreen = document.getElementById('game-screen');
        const startButton = document.getElementById('start-button');
        const endButton = document.getElementById('end-button');
        const timerDisplay = document.getElementById('timer-display');
        const progressBar = document.getElementById('progress-bar');
        const stimulusContainer = document.getElementById('stimulus-container');
        const fixationCross = document.getElementById('fixation-cross');
        const wordPresentation = document.getElementById('word-presentation');
        const stroopWord = document.getElementById('stroop-word');
        const optionButtons = document.querySelectorAll('.option-btn');
        const feedbackContainer = document.getElementById('feedback-container');
        const feedbackIcon = document.getElementById('feedback-icon');
        const feedbackText = document.getElementById('feedback-text');
        const trialsSpan = document.getElementById('trials');
        const accuracySpan = document.getElementById('accuracy');
        const avgReactionTimeSpan = document.getElementById('avg-reaction-time');
        const endGameModal = document.getElementById('end-game-modal');
        const modalCountdownSpan = document.getElementById('modal-countdown');
        const confirmEndButton = document.getElementById('confirm-end-button');

        // --- SVG 图标 ---
        const checkmarkSVG = `<path fill="none" stroke="${getComputedStyle(document.documentElement).getPropertyValue('--correct-color')}" stroke-width="8" stroke-linecap="round" stroke-linejoin="round" d="M20,50 L45,75 L80,25" />`;
        const crossSVG = `<path fill="none" stroke="${getComputedStyle(document.documentElement).getPropertyValue('--incorrect-color')}" stroke-width="8" stroke-linecap="round" d="M20,20 L80,80 M80,20 L20,80" />`;

        // --- 游戏配置与状态变量 ---
        const GAME_DURATION = 120; // 2分钟
        const FEEDBACK_DURATION = 1000;
        const FIXATION_DURATION = 500;
        
        const WORDS = ['红', '黄', '绿', '蓝', '白'];
        const COLORS = {
            '红': 'red',
            '黄': 'yellow',
            '绿': 'green',
            '蓝': 'blue',
            '白': 'white'
        };
        const COLOR_NAMES = Object.keys(COLORS);

        let gameTimerInterval = null, roundTimeout = null, modalTimer = null;
        let timeLeft = GAME_DURATION, trialCount = 0, correctCount = 0, totalReactionTime = 0, roundStartTime = 0;
        let gameActive = false;

        // --- 函数定义 ---
        function init() {
            startButton.addEventListener('click', startGame);
            endButton.addEventListener('click', () => showEndGameModal("确定要结束游戏吗？", "即将返回主页..."));
            confirmEndButton.addEventListener('click', () => { clearTimeout(modalTimer); resetToWelcomeScreen(); });
            optionButtons.forEach(button => button.addEventListener('click', handleResponse));
        }

        function startGame() {
            welcomeScreen.classList.add('hidden');
            gameScreen.style.display = 'flex';
            
            gameActive = true;
            timeLeft = GAME_DURATION;
            trialCount = 0;
            correctCount = 0;
            totalReactionTime = 0;
            updateStatsDisplay();
            
            updateTimerDisplay();
            gameTimerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) endGame();
            }, 1000);

            nextRound();
        }

        function endGame() {
            if (!gameActive) return;
            gameActive = false;
            clearInterval(gameTimerInterval);
            clearTimeout(roundTimeout);
            showEndGameModal("时间到！", "秒后将自动返回主页...");
        }

        function showEndGameModal(title, countdownText) {
            endGameModal.querySelector('p:first-child').textContent = title;
            endGameModal.style.display = 'flex';
            
            let countdown = 5;
            const updateCountdown = () => modalCountdownSpan.textContent = `${countdown}${countdownText}`;
            updateCountdown();

            modalTimer = setInterval(() => {
                countdown--;
                updateCountdown();
                if(countdown <= 0) {
                    clearTimeout(modalTimer);
                    resetToWelcomeScreen();
                }
            }, 1000);
        }

        function resetToWelcomeScreen() {
            gameScreen.style.display = 'none';
            endGameModal.style.display = 'none';
            stimulusContainer.classList.add('hidden');
            feedbackContainer.classList.add('hidden');
            welcomeScreen.classList.remove('hidden');
            
            clearInterval(gameTimerInterval);
            clearTimeout(roundTimeout);
            clearTimeout(modalTimer);
            gameActive = false;
        }

        function updateTimerDisplay() {
            const minutes = String(Math.floor(timeLeft / 60)).padStart(2, '0');
            const seconds = String(timeLeft % 60).padStart(2, '0');
            timerDisplay.textContent = `${minutes}:${seconds}`;
            progressBar.style.width = `${(timeLeft / GAME_DURATION) * 100}%`;
        }
        
        function nextRound() {
            if (!gameActive) return;

            feedbackContainer.classList.add('hidden');
            stimulusContainer.classList.remove('hidden');
            wordPresentation.classList.add('hidden');
            fixationCross.classList.remove('hidden');

            roundTimeout = setTimeout(() => {
                if (!gameActive) return;

                fixationCross.classList.add('hidden');
                
                const randomWordText = WORDS[Math.floor(Math.random() * WORDS.length)];
                const randomColorName = COLOR_NAMES[Math.floor(Math.random() * COLOR_NAMES.length)];
                
                stroopWord.textContent = randomWordText;
                stroopWord.style.color = COLORS[randomColorName];
                
                // 确保文字颜色和含义不同，增加难度
                if (stroopWord.textContent === randomColorName) {
                    return nextRound(); // 重新生成
                }

                // 准备好刺激后，显示并计时
                wordPresentation.style.display = 'flex'; // 使用flex来布局
                stimulusContainer.style.flexDirection = 'row';
                wordPresentation.classList.remove('hidden');
                roundStartTime = performance.now();
            }, FIXATION_DURATION);
        }

        function handleResponse(event) {
            if (!roundStartTime) return;
            const reactionTime = Math.round(performance.now() - roundStartTime);
            roundStartTime = 0;

            const isCorrect = (event.target.dataset.color === stroopWord.style.color);
            updateStats(isCorrect, reactionTime);
            showFeedback(isCorrect, reactionTime);
        }

        function updateStats(isCorrect, reactionTime) {
            trialCount++;
            if (isCorrect) {
                correctCount++;
                totalReactionTime += reactionTime;
            }
            updateStatsDisplay();
        }

        function updateStatsDisplay() {
            trialsSpan.textContent = trialCount;
            accuracySpan.textContent = trialCount > 0 ? `${Math.round((correctCount / trialCount) * 100)}%` : '--';
            avgReactionTimeSpan.textContent = correctCount > 0 ? `${Math.round(totalReactionTime / correctCount)}ms` : '--';
        }
        
        function showFeedback(isCorrect, reactionTime) {
            wordPresentation.classList.add('hidden');
            stimulusContainer.classList.add('hidden'); // 隐藏整个刺激区
            feedbackContainer.classList.remove('hidden'); // 显示反馈区

            feedbackIcon.innerHTML = isCorrect ? checkmarkSVG : crossSVG;
            feedbackText.textContent = `${isCorrect ? '真棒，答对啦' : '诶呀，答错啦'}！你的反应时间为${reactionTime}毫秒`;
            
            roundTimeout = setTimeout(nextRound, FEEDBACK_DURATION);
        }

        // --- 启动脚本 ---
        init();
    </script>
</body>
</html>